<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>GraphQL Client · Treats</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;[GraphQL][GraphQL-website] is a query language for APIs and a runtime for fulfilling those queries with your existing data. GraphQL provides a complete and understandable description of the data in your API, gives clients the power to ask for exactly what they need and nothing more, makes it easier to evolve APIs over time, and enables powerful developer tools.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="GraphQL Client · Treats"/><meta property="og:type" content="website"/><meta property="og:url" content="https://tokopedia.github.io/treats/treats/index.html"/><meta property="og:description" content="&lt;p&gt;[GraphQL][GraphQL-website] is a query language for APIs and a runtime for fulfilling those queries with your existing data. GraphQL provides a complete and understandable description of the data in your API, gives clients the power to ask for exactly what they need and nothing more, makes it easier to evolve APIs over time, and enables powerful developer tools.&lt;/p&gt;
"/><meta property="og:image" content="https://tokopedia.github.io/treats/treats/img/toped.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://tokopedia.github.io/treats/treats/img/toped.png"/><link rel="shortcut icon" href="/treats/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/treats/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/treats/"><img class="logo" src="/treats/img/treats.png" alt="Treats"/><h2 class="headerTitleWithLogo">Treats</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/treats/docs/installation.html" target="_self">Getting Started</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Main Concepts</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/installation.html">Installation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorial</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/tutorial/01.html">01. Creating Your First Page</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/tutorial/02.html">02. Using Redux</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/tutorial/03.html">03. Using GraphQL</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/tutorial/04.html">04. Fetch Data for SSR</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/tutorial/05.html">05. Adding Addons</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Main Concepts</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/routing.html">Routing</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/localization.html">Localization</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/code-splitting.html">Code-splitting</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/redux.html">Redux</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/treats/docs/main-concept/graphql-client.html">GraphQL Client</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/middleware.html">Middlewares</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/helper.html">Helpers</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/server-side-event.html">Server-side Events</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/server-side-template.html">Server-side Template</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/server-side-rendering.html">Server-side Rendering</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/custom-server-app.html">Custom Server App</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/custom-client-initialization.html">Custom Client Initialization</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/custom-react-app.html">Custom React App</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/runtime-config.html">Runtime Config</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/build-config.html">Build Config</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/environment-variable.html">Environment Variables</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/generator.html">Code Generator</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/scripts.html">Scripts</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/addons.html">Addons</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/typescript.html">Typescript</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/filesystem-hooks.html">Filesystem Hooks</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/component.html">Components</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/server.html">Server</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/client.html">Client</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/router.html">Router</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/intl.html">Intl</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/locale-data.html">Locale Data</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/helmet.html">Helmet</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/redux.html">Redux</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/graphql.html">Graphql</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Authoring Addons</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/helper.html">Helpers</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/middleware.html">Middlewares</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/generator.html">Generators</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/wrap-up.html">Wrapping Up</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Addons</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/list-of-addons.html">Treats Addons List</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Contributing</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/contributing/how-to-contribute.html">How To Contribute</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">FAQ</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/faq.html">FAQs</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">GraphQL Client</h1></header><article><div><span><p><a href="https://GraphQL.org/">GraphQL</a> is a query language for APIs and a runtime for fulfilling those queries with your existing data. GraphQL provides a complete and understandable description of the data in your API, gives clients the power to ask for exactly what they need and nothing more, makes it easier to evolve APIs over time, and enables powerful developer tools.</p>
<p>GraphQL Client implementation for Treats uses <a href="http://apolloGraphQL.com/">Apollo Client 2.1</a></p>
<h2><a class="anchor" aria-hidden="true" id="customizing-graphql-client-implementation"></a><a href="#customizing-graphql-client-implementation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Customizing GraphQL Client Implementation</h2>
<p>There's two scenarios available if you want to customize Treats GraphQL Client:</p>
<ol>
<li><p>If you only needs to modify GraphQL http link uri and/or apollo-link-state resolver map, you can just leave other configs to us and just provides:</p>
<ul>
<li><p><code>uri.js</code> - This file can be used to configure http link uri:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// src/_graphql/uri.js</span>
<span class="hljs-keyword">const</span> uri =<span class="hljs-string">"https://graphql.example.endpoint/graphql"</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> uri
</code></pre></li>
<li><p><code>link-state.js</code> - Apollo Client 2.1 comes with a solution to manage your local application state with GraphQL using <a href="https://www.apollographql.com/docs/link/links/state.html">link-state</a>, This file can be used to register resolver maps that would be used with link-state.</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// src/_graphql/link-state.js</span>
<span class="hljs-keyword">const</span> resolverA = {
    <span class="hljs-attr">Mutation</span>: {
        <span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">_, { text }, { cache }</span>) =&gt;</span> {
        ...
        return newTodo;
        },
        <span class="hljs-attr">toggleTodo</span>: <span class="hljs-function">(<span class="hljs-params">_, variables, { cache }</span>) =&gt;</span> {
            ...
        return <span class="hljs-literal">null</span>;
        },
    },
};
<span class="hljs-keyword">const</span> resolverB = {
    <span class="hljs-attr">Mutation</span>: {
        ...
    }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [resolverA, resolverB];
</code></pre></li>
</ul></li>
<li><p>If you want to take more control of your GraphQL client config, you can provide <code>config.js</code> filesystem hooks:</p></li>
</ol>
<pre><code class="hljs css language-js"><span class="hljs-comment">// src/_graphql/config.js</span>
<span class="hljs-keyword">import</span> { RetryLink } <span class="hljs-keyword">from</span> <span class="hljs-string">"apollo-link-retry"</span>;

<span class="hljs-keyword">const</span> customConfig = {
    <span class="hljs-attr">queryDeduplication</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">link</span>: [
        <span class="hljs-comment">// using provided apollo-link-error</span>
        {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"error"</span>,
            <span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">{ graphQLErrors, networkError }</span>) =&gt;</span> {
                ...
            }
        },
        <span class="hljs-comment">//using provided apollo-link-batch-http</span>
        {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"batch-http"</span>,
            <span class="hljs-attr">uri</span>: <span class="hljs-string">"http://example.graphql.endpoint/graphql"</span>
        },
        <span class="hljs-comment">//using custom installed RetryLink</span>
        <span class="hljs-keyword">new</span> RetryLink({
            <span class="hljs-attr">delay</span>: {
                <span class="hljs-attr">initial</span>: <span class="hljs-number">300</span>,
                <span class="hljs-attr">max</span>: <span class="hljs-literal">Infinity</span>,
                <span class="hljs-attr">jitter</span>: <span class="hljs-literal">true</span>
            },
            <span class="hljs-attr">attempts</span>: {
                <span class="hljs-attr">max</span>: <span class="hljs-number">5</span>,
                <span class="hljs-attr">retryIf</span>: <span class="hljs-function">(<span class="hljs-params">error, _operation</span>) =&gt;</span> !!error
            }
        })
    ]
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> customConfig;
</code></pre>
<p>We provides several apollo-link by default:</p>
<ol>
<li><a href="https://www.npmjs.com/package/apollo-link-batch-http">batch-http</a> - Batch HTTP requests together.</li>
<li><a href="https://www.npmjs.com/package/apollo-link-http">http</a> - Normal HTTP requests link.</li>
<li><a href="https://www.apollographql.com/docs/react/features/error-handling.html">error</a> - Error handling link.</li>
<li><a href="https://www.apollographql.com/docs/link/links/state.html">state</a> - Manage local state with GraphQL.</li>
</ol>
<blockquote>
<p>Please note that there's still several apollo mandatory and best practices that we'll provides, for example turning ssrMode on server environment</p>
</blockquote>
<p>More information about these filesystem hooks can be found <a href="../api-reference/filesystem-hooks.html#graphql-link-statejs">here</a></p>
<h2><a class="anchor" aria-hidden="true" id="using-graphql-client"></a><a href="#using-graphql-client" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using GraphQL Client</h2>
<p>To use graphQL client we can import any apollo client components from <code>@treats/graphql</code>:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// src/page/my-page/my-page.js</span>
<span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { Query } <span class="hljs-keyword">from</span> <span class="hljs-string">"@treats/graphql"</span>;
<span class="hljs-keyword">import</span> myQuery <span class="hljs-keyword">from</span> <span class="hljs-string">"../graphql/my-query.graphql"</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    ...
    render() {
        <span class="hljs-keyword">const</span> { someParameter } = <span class="hljs-keyword">this</span>.props;
        <span class="hljs-keyword">return</span> (
            &lt;div&gt;
                &lt;Query query={myQuery.myData} variables={someParameter}&gt;
                    {({ data, loading, error }) =&gt; {
                        if(error) {
                            return (
                                &lt;span&gt;Error! {error}&lt;/span&gt;
                            );
                        }
                        if(loading) {
                            return (
                                &lt;span&gt;Loading...&lt;/span&gt;
                            );
                        }
                        return (
                            &lt;span&gt;&lt;RENDER SOMETHING WITH THE DATA&gt;&lt;span&gt;
                        );
                    }}
                &lt;/Query&gt;
            &lt;/div&gt;
        );
    }
}

export default AsyncComponent(module, MyPage);
</code></pre>
<p>Then we define our graphQL query on a <code>.graphql</code> file:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// src/graphql/my-query.graphql</span>
query myData($param1: Int!, <span class="hljs-attr">$param2</span>: <span class="hljs-built_in">String</span>) {
    data(param1: $param1, <span class="hljs-attr">param2</span>: $param2) {
        something {
            field1
            field2
            field3
        }
    }
}
</code></pre>
<blockquote>
<p>PROTIP: To disable SSR for Query component, we can just set its <code>ssr</code> props to <code>false</code>.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="disable-graphql-client"></a><a href="#disable-graphql-client" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Disable GraphQL Client</h2>
<p>To disable GraphQL client and removes it from your build, you can set build config for GraphQLClient on <code>treats.config.js</code> to <strong>false</strong>:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// treats.config.js</span>

<span class="hljs-built_in">module</span>.exports = {
    ...,
    <span class="hljs-attr">build</span>: {
        <span class="hljs-attr">graphql</span>: <span class="hljs-literal">false</span>
    },
    ...
}

</code></pre>
<p>Please note that with the above configuration, all GraphQL client related filesystem hooks wouldn't have any effect and you'll need to explicitly enable GraphQL client again from build config to start using them again.</p>
<p>More info about <code>treats.config.js</code> can be found on <a href="build-config.html">build config</a> section.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/treats/docs/main-concept/redux.html"><span class="arrow-prev">← </span><span>Redux</span></a><a class="docs-next button" href="/treats/docs/main-concept/middleware.html"><span>Middlewares</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><a href="https://github.com/tokopedia/" target="_blank" rel="noreferrer noopener" class="tkpdOpensource"><img class="tkpdOpenSourceLogo" src="/treats/img/tokopedia.png" alt="Tokopedia Open Source"/></a><section class="copyright">Copyright © 2019 Tokopedia OSS</section></footer></div></body></html>